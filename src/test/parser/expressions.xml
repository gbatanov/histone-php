<?xml version="1.0" encoding="UTF-8"?>
<suites>

    <suite name="expressions">

        <case>
            <input>{{null or 1 or .14 or 'string'}}</input>
            <expected type="json">[[1,[1,[1, [100], [101,1]],[102,0.14]],[103,"string"]]]</expected>
        </case>

        <case>
            <input>{{null or 1 or .14 or string'}}</input>
            <exception>
                <line>1</line>
                <expected>}}</expected>
                <found>'</found>
            </exception>
        </case>

        <case>
            <input>{{-10.foo}}</input>
            <expected type="json">[[105,[[14,[101,10]],"foo"]]]</expected>
        </case>

        <case>
            <input>{{0 and 1 and 3}}</input>
            <expected type="json">[[2,[2,[101,0],[101,1]],[101,3]]]</expected>
        </case>

        <case>
            <input>{{0 and 1 and}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{true is false}}</input>
            <expected type="json">[[3, [16], [17]]]</expected>
        </case>

        <case>
            <input>{{true is}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{true isNot false}}</input>
            <expected type="json">[[4, [16], [17]]]</expected>
        </case>

        <case>
            <input>{{true isNot}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{10 &lt;= 20}}</input>
            <expected type="json">[[5, [101, 10], [101, 20]]]</expected>
        </case>

        <case>
            <input>{{10 &lt;=}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{10 &lt; 20}}</input>
            <expected type="json">[[6, [101, 10], [101, 20]]]</expected>
        </case>

        <case>
            <input>{{10 &lt;}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{10 &gt;= 20}}</input>
            <expected type="json">[[7, [101, 10], [101, 20]]]</expected>
        </case>

        <case>
            <input>{{10 &gt;=}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{10 &gt; 20}}</input>
            <expected type="json">[[8, [101, 10], [101, 20]]]</expected>
        </case>

        <case>
            <input>{{10 &gt;}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{10 + 20}}</input>
            <expected type="json">[[9, [101, 10], [101, 20]]]</expected>
        </case>

        <case>
            <input>{{10 +}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{10 - 20}}</input>
            <expected type="json">[[10, [101, 10], [101, 20]]]</expected>
        </case>

        <case>
            <input>{{10 -}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{10 * 20}}</input>
            <expected type="json">[[11, [101, 10], [101, 20]]]</expected>
        </case>

        <case>
            <input>{{10 *}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{10 / 20}}</input>
            <expected type="json">[[12, [101, 10], [101, 20]]]</expected>
        </case>

        <case>
            <input>{{10 /}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{10 mod 20}}</input>
            <expected type="json">[[13, [101, 10], [101, 20]]]</expected>
        </case>

        <case>
            <input>{{10 mod}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{+10}}</input>
            <expected type="json">[[101, 10]]</expected>
        </case>

        <case>
            <input>{{++10}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>+</found>
            </exception>
        </case>

        <case>
            <input>{{-10}}</input>
            <expected type="json">[[14, [101, 10]]]</expected>
        </case>

        <case>
            <input>{{--10}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>-</found>
            </exception>
        </case>

        <case>
            <input>{{not true}}</input>
            <expected type="json">[[15, [16]]]</expected>
        </case>

        <case>
            <input>{{not}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{not false}}</input>
            <expected type="json">[[15, [17]]]</expected>
        </case>

        <case>
            <input>a {{-false}} b</input>
            <expected type="json">["a ",[14,[17]]," b"]</expected>
        </case>

        <case>
            <input>a {{-true}} b</input>
            <expected type="json">["a ",[14,[16]]," b"]</expected>
        </case>


        <case>
            <input>{{not true not}}</input>
            <exception>
                <line>1</line>
                <expected>}}</expected>
                <found>not</found>
            </exception>
        </case>

        <case>
            <input>{{true}}</input>
            <expected type="json">[[16]]</expected>
        </case>

        <case>
            <input>{{false}}</input>
            <expected type="json">[[17]]</expected>
        </case>

        <case>
            <input>{{null}}</input>
            <expected type="json">[[100]]</expected>
        </case>

        <case>
            <input>{{null.11}}</input>
            <exception>
                <line>1</line>
                <expected>}}</expected>
                <found>.11</found>
            </exception>
        </case>

        <case>
            <input>{{10}}</input>
            <expected type="json">[[101, 10]]</expected>
        </case>

        <case>
            <input>{{0.14}}</input>
            <expected type="json">[[102, 0.14]]</expected>
        </case>

        <case>
            <input>{{0..14}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>.14</found>
            </exception>
        </case>

        <case>
            <input>{{.234}}</input>
            <expected type="json">[[102, 0.234]]</expected>
        </case>

        <case>
            <input>{{..245}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>.</found>
            </exception>
        </case>

        <case>
            <input>{{10E3}}</input>
            <expected type="json">[[102, 10000]]</expected>
        </case>

        <case>
            <input>{{10B2}}</input>
            <exception>
                <line>1</line>
                <expected>}}</expected>
                <found>B2</found>
            </exception>
        </case>

        <case>
            <input>{{10E+2}}</input>
            <expected type="json">[[102, 1000]]</expected>
        </case>

        <case>
            <input>{{4E-2}}</input>
            <expected type="json">[[102, 0.04]]</expected>
        </case>

        <case>
            <input>{{10E*2}}</input>
            <exception>
                <line>1</line>
                <expected>}}</expected>
                <found>E</found>
            </exception>
        </case>

        <case>
            <input>{{.27E3}}</input>
            <expected type="json">[[102, 270]]</expected>
        </case>

        <case>
            <input>{{.12E+2}}</input>
            <expected type="json">[[102, 12]]</expected>
        </case>

        <case>
            <input>{{.14E-2}}</input>
            <expected type="json">[[102, 0.0014]]</expected>
        </case>

        <case>
            <input>{{'string'}}</input>
            <expected type="json">[[103, "string"]]</expected>
        </case>

        <case>
            <input>{{'my str'ing'}}</input>
            <exception>
                <line>1</line>
                <expected>}}</expected>
                <found>ing</found>
            </exception>
        </case>

        <case>
            <input>{{"string"}}</input>
            <expected type="json">[[103, "string"]]</expected>
        </case>

        <case>
            <input>{{"my str"ing"}}</input>
            <exception>
                <line>1</line>
                <expected>}}</expected>
                <found>ing</found>
            </exception>
        </case>

        <case>
            <input>{{'str\'ing'}}</input>
            <expected type="json">[[103, "str'ing"]]</expected>
        </case>

        <case>
            <input>{{'my str\\'ing'}}</input>
            <exception>
                <line>1</line>
                <expected>}}</expected>
                <found>ing</found>
            </exception>
        </case>

        <case>
            <input>{{"str\"ing"}}</input>
            <expected type="json">[[103, "str\"ing"]]</expected>
        </case>

        <case>
            <input>{{"my str\\"ing"}}</input>
            <exception>
                <line>1</line>
                <expected>}}</expected>
                <found>ing</found>
            </exception>
        </case>

        <case>
            <input>{{'str\u0040ing'}}</input>
            <expected type="json">[[103, "str@ing"]]</expected>
        </case>

        <case>
            <input>{{'str\u004ing'}}</input>
            <expected type="json">[[103, "str\\u004ing"]]</expected>
        </case>

        <case>
            <input>{{'str\x58ing'}}</input>
            <expected type="json">[[103, "strXing"]]</expected>
        </case>

        <case>
            <input>{{'str\x5ing'}}</input>
            <expected type="json">[[103, "str\\x5ing"]]</expected>
        </case>

        <case>
            <input>{{'str\121ing'}}</input>
            <expected type="json">[[103, "str\\121ing"]]</expected>
        </case>

        <case>
            <input>{{'str\11ing'}}</input>
            <expected type="json">[[103, "str\\11ing"]]</expected>
        </case>

        <case>
            <input>{{'str\bing'}}</input>
            <expected type="json">[[103, "str\bing"]]</expected>
        </case>

        <case>
            <input>{{'str\\bing'}}</input>
            <expected type="json">[[103, "str\\bing"]]</expected>
        </case>

        <case>
            <input>{{'str\ting'}}</input>
            <expected type="json">[[103, "str\ting"]]</expected>
        </case>

        <case>
            <input>{{'str\\ting'}}</input>
            <expected type="json">[[103, "str\\ting"]]</expected>
        </case>

        <case>
            <input>{{'str\ning'}}</input>
            <expected type="json">[[103, "str\ning"]]</expected>
        </case>

        <case>
            <input>{{'str\\ning'}}</input>
            <expected type="json">[[103, "str\\ning"]]</expected>
        </case>

        <case>
            <input>{{'str\fing'}}</input>
            <expected type="json">[[103, "str\fing"]]</expected>
        </case>

        <case>
            <input>{{'str\\fing'}}</input>
            <expected type="json">[[103, "str\\fing"]]</expected>
        </case>

        <case>
            <input>{{'str\ring'}}</input>
            <expected type="json">[[103, "str\ring"]]</expected>
        </case>

        <case>
            <input>{{'str\\ring'}}</input>
            <expected type="json">[[103, "str\\ring"]]</expected>
        </case>

        <case>
            <input>a {{title[1].hey}} b {{foo.bar(1, 2, 3)}} c</input>
            <expected type="json">["a ",[105,["title",[101,1],"hey"]]," b ",[106,[105,["foo"]],"bar",[[101,1],[101,2],[101,3]]]," c"]
            </expected>
        </case>

        <case>
            <input>a {{title[1].hey}} b</input>
            <expected type="json">["a ",[105,["title",[101,1],"hey"]]," b"]</expected>
        </case>

        <case>
            <input>a {{foo[title[1].hey].bingo[1].bongo}} b</input>
            <expected type="json">["a ",[105,["foo",[105,["title",[101,1],"hey"]],"bingo",[101,1],"bongo"]]," b"]
            </expected>
        </case>

        <case>
            <input>{{10 * () + 2}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>()</found>
            </exception>
        </case>

        <case>
            <input>{{10 * (.14 / 2}}</input>
            <exception>
                <line>1</line>
                <expected>)</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{foo.true}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>true</found>
            </exception>
        </case>

        <case>
            <input>{{foo[]}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>[]</found>
            </exception>
        </case>

        <case>
            <input>{{foo['sss'}}</input>
            <exception>
                <line>1</line>
                <expected>]</expected>
                <found>}}</found>
            </exception>
        </case>
        <case>
            <input>{{10 * 2 + 'xxxxx'</input>
            <exception>
                <line>1</line>
                <expected>}}</expected>
                <found>EOF</found>
            </exception>
        </case>

        <case>
            <input>a {{this.this}} b</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>this</found>
            </exception>
        </case>

        <case>
            <input>a {{self.self}} b</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>self</found>
            </exception>
        </case>

        <case>
            <input>a {{this.self}} b</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>self</found>
            </exception>
        </case>

        <case>
            <input>a {{self.this}} b</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>this</found>
            </exception>
        </case>

        <case>
            <input>{{this}}</input>
            <expected type="json">[[105,["this"]]]</expected>
        </case>

        <case>
            <input>{{test}}</input>
            <expected type="json">[[105, ["test"]]]</expected>
        </case>

        <case>
            <input>{{test.foo}}</input>
            <expected type="json">[[105, ["test", "foo"]]]</expected>
        </case>

        <case>
            <input>{{this.foo}}</input>
            <expected type="json">[[105, ["this", "foo"]]]</expected>
        </case>

        <case>
            <input>{{self}}</input>
            <expected type="json">[[105,["self"]]]</expected>
        </case>

        <case>
            <input>{{self.foo}}</input>
            <expected type="json">[[105, ["self", "foo"]]]</expected>
        </case>

        <case>
            <input>{{test.}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{this.}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{self.}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{test['foo']}}</input>
            <expected type="json">[[105, ["test", [103, "foo"]]]]</expected>
        </case>

        <case>
            <input>{{this['foo']}}</input>
            <expected type="json">[[105, ["this", [103, "foo"]]]]</expected>
        </case>

        <case>
            <input>{{self['foo']}}</input>
            <expected type="json">[[105, ["self", [103, "foo"]]]]</expected>
        </case>

        <case>
            <input>{{test[}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{this[}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{self[}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{test[1}}</input>
            <exception>
                <line>1</line>
                <expected>]</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{this[1}}</input>
            <exception>
                <line>1</line>
                <expected>]</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{self[1}}</input>
            <exception>
                <line>1</line>
                <expected>]</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{test[1,}}</input>
            <exception>
                <line>1</line>
                <expected>]</expected>
                <found>,</found>
            </exception>
        </case>

        <case>
            <input>{{this[1,}}</input>
            <exception>
                <line>1</line>
                <expected>]</expected>
                <found>,</found>
            </exception>
        </case>

        <case>
            <input>{{self[1,}}</input>
            <exception>
                <line>1</line>
                <expected>]</expected>
                <found>,</found>
            </exception>
        </case>

        <case>
            <input>{{test['foo'].bar}}</input>
            <expected type="json">[[105, ["test", [103, "foo"], "bar"]]]</expected>
        </case>

        <case>
            <input>{{this['foo'].bar}}</input>
            <expected type="json">[[105, ["this", [103, "foo"], "bar"]]]</expected>
        </case>

        <case>
            <input>{{self['foo'].bar}}</input>
            <expected type="json">[[105, ["self", [103, "foo"], "bar"]]]</expected>
        </case>

        <case>
            <input>{{test['foo'].}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{this['foo'].}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{self['foo'].}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{test['foo']['bar']}}</input>
            <expected type="json">[[105, ["test", [103, "foo"], [103, "bar"]]]]</expected>
        </case>

        <case>
            <input>{{this['foo']['bar']}}</input>
            <expected type="json">[[105, ["this", [103, "foo"], [103, "bar"]]]]</expected>
        </case>

        <case>
            <input>{{self['foo']['bar']}}</input>
            <expected type="json">[[105, ["self", [103, "foo"], [103, "bar"]]]]</expected>
        </case>

        <case>
            <input>{{test['foo'].['bar']}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>[</found>
            </exception>
        </case>

        <case>
            <input>{{this['foo'].['bar']}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>[</found>
            </exception>
        </case>

        <case>
            <input>{{self['foo'].['bar']}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>[</found>
            </exception>
        </case>

        <case>
            <input>{{test['foo'].hey['bar']}}</input>
            <expected type="json">[[105, ["test", [103, "foo"], "hey", [103, "bar"]]]]</expected>
        </case>

        <case>
            <input>{{this['foo'].hey['bar']}}</input>
            <expected type="json">[[105, ["this", [103, "foo"], "hey", [103, "bar"]]]]</expected>
        </case>

        <case>
            <input>{{self['foo'].hey['bar']}}</input>
            <expected type="json">[[105, ["self", [103, "foo"], "hey", [103, "bar"]]]]</expected>
        </case>

        <case>
            <input>{{this['foo'].this['bar']}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>this</found>
            </exception>
        </case>

        <case>
            <input>{{self['foo'].self['bar']}}</input>
            <exception>
                <line>1</line>
                <expected>identifier</expected>
                <found>self</found>
            </exception>
        </case>

        <case>
            <input>{{10 ? "20" : .30}}</input>
            <expected type="json">[[104,
                [101, 10],
                [103, "20"],
                [102, 0.3]
                ]]
            </expected>
        </case>

        <case>
            <input>{{null ? 10 ? 3.14 : "string" : 1E5 ? '' : .1E-2}}</input>
            <expected type="json">[[104, [100],
                [104, [101,10], [102,3.14], [103,"string"]],
                [104,[102,100000],[103,""],[102,0.001]]
                ]]
            </expected>
        </case>

        <case>
            <input>{{10 ? "20"}}</input>
            <expected type="json">[[104,
                [101, 10],
                [103, "20"]
                ]]
            </expected>
        </case>

        <case>
            <input>{{10 ? # : .30}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>#</found>
            </exception>
        </case>

        <case>
            <input>{{10 ? 10 :}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>}}</found>
            </exception>
        </case>

        <case>
            <input>{{10 ? 10 : #}}</input>
            <exception>
                <line>1</line>
                <expected>expression</expected>
                <found>#</found>
            </exception>
        </case>

        <case>
            <input>{{10*(13+2)}}</input>
            <expected type="json">[[11,[101,10],[9,[101,13],[101,2]]]]</expected>
        </case>

    </suite>
</suites>